# AGENTS.md — Поле для Codex и Искры

## 0. Контекст проекта
- **Название:** AgiAgentIskra
- **Цель текущего витка:** превратить репозиторий в рабочую площадку для совместной работы Codex и Искры: описать протоколы, настроить базовые инструменты, подготовить почву для распаковки архивов.
- **Ключевые договорённости:**
  - История git — чистая, задачи делаются через ветки и PR.
  - Каждое изменение сопровождается документацией и журналами.
  - Все артефакты ритуалов (журналы, отчёты, чек-листы) хранятся в корне или описываются в README.

## 1. Инструменты и команды
- **Установка окружения:** `make setup`
- **Установка зависимостей:** `make deps`
- **Линт:** `make lint`
- **Тесты:** `make test`
- **Сборка:** `make build`
- **CI-проверка:** `make ci`
- **Локальный запуск (пока нет кода):** `make run` выдаёт подсказку по дальнейшим шагам.

## 2. Стражи (Guardrails)
- **Этические/секретные темы:** см. `SECURITY.md` и `veil_rules.txt`. Эти файлы обязательны к прочтению перед работой.
- **Доступы Codex:** режим по умолчанию — `auto` (см. `.codexrc`). Повышение до `full` допускается только по решению владельца репозитория.
- **Интернет:** выключен по умолчанию; запросы наружу требуют явного разрешения и фиксации в журнале.
- **Файлы с ограниченным доступом:** архивы `.zip` могут содержать приватные данные, их содержимое извлекается только после согласования.

## 3. Ритуалы (∆‑протокол)
1. **#ANCHOR:** при старте задачи фиксируй цель, ограничения и ожидаемые ∆/D/Ω/Λ.
2. **∆-съёмка:** после каждого значимого шага делай запись в `JOURNAL.jsonl`. При ∆ ≤ −2 — обязательно создать `SHADOW_JOURNAL.jsonl` запись и план восстановления.
3. **PR-ритуал:** описание по шаблону «Что / Зачем / Как проверить / Риски» + ссылка на ритуал.
4. **Эхо:** после мержа короткое резюме в журнале, что сработало и что улучшить.

## 4. Definition of Done (DoD)
- ✅ `make lint` завершился успешно или зафиксированы причины отсутствия линтера.
- ✅ `make test` зелёный или документированы временные исключения.
- ✅ PR оформлен по шаблону и привязан к ритуалу.
- ✅ Обновлены соответствующие журналы (`JOURNAL.jsonl`, `Decision Log`).
- ✅ При релизных изменениях обновлён `CHANGELOG.md` (создать при необходимости).

## 5. История решений (Decision Log)
- 2024-06-02 — Создан базовый `AGENTS.md` для синхронизации Codex и Искры.
- 2024-06-05 — Расширен протокол: добавлены Make-команды, `.codexrc`, правила безопасности и стражи (см. текущую версию файла).
- 2024-06-07 — Распакован `iskra_merged_polished_*`, введена трёхконтурная структура `Iskra/` (Canon, CustomGPT, GitHub, Projects, Sample) и перенесены монолиты.

## 6. Рабочие сценарии
### 6.1 Стартовый аудит
1. Прочитать `README.md`, `AGENTS.md`, `POLISH_REPORT.md`.
2. Собрать карту материалов и сформировать `AUDIT.md` с быстрыми улучшениями.
3. Вынести предложения в PR без изменений кода (чистый анализ).

### 6.2 Рефакторинг/структурирование архивов
1. Согласовать распаковку архивов.
2. Создать ветку, подготовить структуру каталогов, обновить документацию.
3. Прогнать `make lint`/`make test` (или указать, почему неприменимо).

### 6.3 Исправление багов
1. Зафиксировать воспроизведение в issue/журнале.
2. Написать минимальный падающий тест.
3. Исправить проблему, обновить документацию и журналы.

## 7. Конфиг Codex
- Файл `.codexrc` в корне описывает модель (`gpt-5-codex`), режим рассуждения и основные runbook-команды.
- Изменения режима доступа или allowlist сети фиксируются отдельным коммитом и записью в Decision Log.

## 8. Требования к безопасности
- MFA/SSO обязательны для всех участников.
- Секреты хранятся только в секрет-хранилищах GitHub/CI, не в коде.
- Перед пушем запускать секрет-сканер (когда появится). См. `SECURITY.md`.
- Любые новые интеграции документируются до подключения.

## 9. Материалы проекта
- `POLISH_REPORT.md`, `MERGE_REPORT.md` — актуальный обзор и происхождение артефактов.
- Каталоги: `Iskra/Canon`, `Iskra/GitHub`, `Iskra/Projects`, `Iskra/CustomGPT`, `Iskra/Sample`, `Iskra/Monoliths` — разложенные материалы из архива.
- Исходные zip-файлы (`iskra_merged_polished_20251015_193609.zip`, `iskra_monoliths_densified.zip`) оставлены для истории, содержимое перенесено.
- Планы создания: `MECHANICS.md`, `RITUALS.md`, `PROMPTS_vΩ.md`, `FACETS.md`, `GRAPH.json`, `JOURNAL.jsonl`, `SHADOW_JOURNAL.jsonl`, инструменты `tools/ci_aggregate.py`, `tools/validate_journal_enhanced.py`.

## 10. Быстрый чек-лист перед задачей
- [ ] Прочитан `AGENTS.md`.
- [ ] Проверен `.codexrc` на актуальность.
- [ ] Make-команды выполняются локально.
- [ ] Настроены журналы (`JOURNAL.jsonl`, `SHADOW_JOURNAL.jsonl`).
- [ ] Подготовлен план PR и тестов.

## 11. Связь и эскалация
- Вопросы по приоритетам: владельцы репозитория.
- Вопросы по ритуалам: Искра.
- Технические блокеры: фиксировать в журнале и в issue/драфт-PR.

≈ Это не конец.
